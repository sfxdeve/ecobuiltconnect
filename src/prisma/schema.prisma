generator client {
  provider = "prisma-client"
  output   = "./generated"
}

datasource db {
  provider = "postgresql"
}

enum ProfileStatus {
  PENDING
  APPROVED
  REJECTED
}

model UserProfile {
  id String @id @default(uuid())

  clerkId  String        @unique @map("clerk_id")
  name     String
  address  String
  city     String
  postcode String
  status   ProfileStatus @default(APPROVED)

  productRequests ProductRequest[]
  orderRequests   OrderRequest[]
  reviews         Review[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model VendorProfile {
  id String @id @default(uuid())

  clerkId     String        @unique @map("clerk_id")
  pictureKeys String[]      @map("picture_keys")
  name        String
  description String
  address     String
  city        String
  postcode    String
  status      ProfileStatus @default(PENDING)

  bankAccount BankAccount?

  products Product[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model LogisticProfile {
  id String @id @default(uuid())

  clerkId     String        @unique @map("clerk_id")
  pictureKeys String[]      @map("picture_keys")
  name        String
  description String
  address     String
  city        String
  postcode    String
  status      ProfileStatus @default(PENDING)

  logisticResponses LogisticResponse[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model AdminProfile {
  id String @id @default(uuid())

  clerkId     String        @unique @map("clerk_id")
  name        String
  description String
  status      ProfileStatus @default(PENDING)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model BankAccount {
  id String @id @default(uuid())

  bankName      String @map("bank_name")
  branchCode    String @map("branch_code")
  accountType   String @map("account_type")
  accountName   String @map("account_name")
  accountNumber String @map("account_number")

  vendorProfileId String        @unique @map("vendor_profile_id")
  vendorProfile   VendorProfile @relation(fields: [vendorProfileId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

enum CategoryStatus {
  REQUESTED
  REJECTED
  APPROVED
}

model Category {
  id String @id @default(uuid())

  name      String
  status    CategoryStatus @default(REQUESTED)
  isDeleted Boolean        @default(false) @map("is_deleted")

  products        Product[]
  productRequests ProductRequest[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

enum ProductCondition {
  EXCELLENT
  GOOD
  FAIR
}

model Product {
  id String @id @default(uuid())

  pictureKeys   String[]         @map("picture_keys")
  name          String
  description   String
  previousUsage String?          @map("previous_usage")
  sku           String
  stock         Int
  price         Int
  salePrice     Int?             @map("sale_price")
  condition     ProductCondition
  isVerified    Boolean          @default(false) @map("is_verified")
  isDeleted     Boolean          @default(false) @map("is_deleted")

  categoryId String   @map("category_id")
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  vendorProfileId String        @map("vendor_profile_id")
  vendorProfile   VendorProfile @relation(fields: [vendorProfileId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  productRequestId String?         @map("product_request_id")
  productRequest   ProductRequest? @relation(fields: [productRequestId], references: [id], onDelete: SetNull, onUpdate: Cascade)

  orderItems OrderItem[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([vendorProfileId, sku])
}

model ProductRequest {
  id String @id @default(uuid())

  pictureKeys String[] @map("picture_keys")
  name        String
  description String
  quantity    Int
  price       Int
  isDeleted   Boolean  @default(false) @map("is_deleted")

  categoryId String   @map("category_id")
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  userProfileId String      @map("user_profile_id")
  userProfile   UserProfile @relation(fields: [userProfileId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  products Product[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model OrderItem {
  id       String @id @default(uuid())
  quantity Int
  price    Int

  orderRequestId String       @map("order_request_id")
  orderRequest   OrderRequest @relation(fields: [orderRequestId], references: [id], onDelete: Cascade)

  productId String  @map("product_id")
  product   Product @relation(fields: [productId], references: [id])

  review Review?

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

enum OrderStatus {
  PENDING
  CANCELLED
  PAID
  PROCESSING
  READY
  COMPLETED
}

model OrderRequest {
  id String @id @default(uuid())

  total  Int
  status OrderStatus @default(PENDING)

  userProfileId String      @map("user_profile_id")
  userProfile   UserProfile @relation(fields: [userProfileId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  logisticRequest LogisticRequest?

  orderItems OrderItem[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

enum LogisticStatus {
  PENDING
  PROPOSED
  ACCEPTED
  CANCELLED
  PAID
  PROCESSING
  IN_TRANSIT
  DELIVERED
}

model LogisticRequest {
  id String @id @default(uuid())

  requestedPrice Int            @map("requested_price")
  acceptedPrice  Int?           @map("accepted_price")
  status         LogisticStatus @default(PENDING)

  orderRequestId String       @unique @map("order_request_id")
  orderRequest   OrderRequest @relation(fields: [orderRequestId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  logisticResponses LogisticResponse[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model LogisticResponse {
  id String @id @default(uuid())

  price Int

  logisticProfileId String          @map("logistic_profile_id")
  logisticProfile   LogisticProfile @relation(fields: [logisticProfileId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  logisticRequestId String          @map("logistic_request_id")
  logisticRequest   LogisticRequest @relation(fields: [logisticRequestId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model Review {
  id String @id @default(uuid())

  rating  Int
  comment String

  userProfileId String      @map("user_profile_id")
  userProfile   UserProfile @relation(fields: [userProfileId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  orderItemId String    @unique @map("order_item_id")
  orderItem   OrderItem @relation(fields: [orderItemId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}
