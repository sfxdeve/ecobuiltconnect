generator client {
  provider = "prisma-client"
  output   = "./generated"
}

datasource db {
  provider = "postgresql"
}

enum ProfileStatus {
  PENDING
  APPROVED
  REJECTED
}

model UserProfile {
  id String @id @default(uuid())

  clerkId  String        @unique @map("clerk_id")
  postcode String
  city     String
  address  String
  status   ProfileStatus @default(APPROVED)

  productRequests ProductRequest[]
  orderRequests   OrderRequest[]
  reviews         Review[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model VendorProfile {
  id String @id @default(uuid())

  clerkId     String        @unique @map("clerk_id")
  pictureId   String        @map("picture_id")
  description String
  postcode    String
  city        String
  address     String
  status      ProfileStatus @default(PENDING)

  products Product[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model LogisticProfile {
  id String @id @default(uuid())

  clerkId     String        @unique @map("clerk_id")
  pictureId   String        @map("picture_id")
  description String
  postcode    String
  city        String
  address     String
  status      ProfileStatus @default(PENDING)

  logisticResponses LogisticResponse[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model AdminProfile {
  id String @id @default(uuid())

  clerkId String        @unique @map("clerk_id")
  status  ProfileStatus @default(PENDING)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

enum CategoryStatus {
  REQUESTED
  APPROVED
  REJECTED
}

model Category {
  id String @id @default(uuid())

  name      String
  status    CategoryStatus @default(REQUESTED)
  isDeleted Boolean        @default(false) @map("is_deleted")

  products        Product[]
  productRequests ProductRequest[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

enum ProductCondition {
  EXCELLENT
  GOOD
  FAIR
}

model Product {
  id String @id @default(uuid())

  pictureIds    String[]         @map("picture_ids")
  name          String
  description   String
  previousUsage String?          @map("previous_usage")
  sku           String           @unique
  stock         Int
  price         Float
  salePrice     Float?           @map("sale_price")
  condition     ProductCondition @default(GOOD)
  isVerified    Boolean          @default(false) @map("is_verified")
  isDeleted     Boolean          @default(false) @map("is_deleted")

  categoryId String   @map("category_id")
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  vendorId String        @map("vendor_id")
  vendor   VendorProfile @relation(fields: [vendorId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  requestId String?         @map("request_id")
  request   ProductRequest? @relation(fields: [requestId], references: [id], onDelete: SetNull, onUpdate: Cascade)

  orderItems OrderItem[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model ProductRequest {
  id String @id @default(uuid())

  pictureIds  String[] @map("picture_ids")
  name        String
  description String
  quantity    Int
  price       Float
  isDeleted   Boolean  @default(false) @map("is_deleted")

  categoryId String   @map("category_id")
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  userId String      @map("user_id")
  user   UserProfile @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  products Product[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model OrderItem {
  id       String @id @default(uuid())
  quantity Int
  price    Float

  orderId String       @map("order_id")
  order   OrderRequest @relation(fields: [orderId], references: [id], onDelete: Cascade)

  productId String  @map("product_id")
  product   Product @relation(fields: [productId], references: [id])

  review Review?

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

enum OrderStatus {
  PENDING
  PAID
  PROCESSING
  READY
  COMPLETED
}

model OrderRequest {
  id String @id @default(uuid())

  total  Float
  status OrderStatus @default(PENDING)

  userId String      @map("user_id")
  user   UserProfile @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  logisticRequest LogisticRequest?

  orderItems OrderItem[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

enum LogisticStatus {
  PENDING
  PROPOSED
  ACCEPTED
  PAID
  PROCESSING
  IN_TRANSIT
  DELIVERED
}

model LogisticRequest {
  id String @id @default(uuid())

  requestedPrice Float          @map("requested_price")
  acceptedPrice  Float?         @map("accepted_price")
  status         LogisticStatus @default(PENDING)

  orderId String       @unique @map("order_id")
  order   OrderRequest @relation(fields: [orderId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  logisticResponses LogisticResponse[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model LogisticResponse {
  id String @id @default(uuid())

  price Float

  logisticId String          @map("logistic_id")
  logistic   LogisticProfile @relation(fields: [logisticId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  requestId String          @map("request_id")
  request   LogisticRequest @relation(fields: [requestId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}

model Review {
  id String @id @default(uuid())

  rating  Int
  comment String

  userId String      @map("user_id")
  user   UserProfile @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  itemId String    @unique @map("item_id")
  item   OrderItem @relation(fields: [itemId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
}
